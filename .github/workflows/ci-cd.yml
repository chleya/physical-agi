name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  # ===================
  # Build Verification
  # ===================
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -q numpy pandas matplotlib
    
    - name: Verify imports
      run: |
        python -c "import simulator_v2; print('Simulation module OK')"
        python -c "from core import physics_engine; print('Physics engine OK')"

  # ===================
  # Hardware Tools Test
  # ===================
  hardware-tools:
    runs-on: ubuntu-latest
    needs: build
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install -q pyserial opencv-python matplotlib
    
    - name: Test hardware tools import
      run: |
        cd hardware_test
        python -c "import stm32_chip; print('Chip config OK')"
        python -c "import device_config; print('Device config OK')"

  # ===================
  # Documentation
  # ===================
  docs:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Validate README exists
      run: |
        test -f README.md && echo "README found"
        test -f hardware_test/flash_tool.py && echo "Flash tool found"
