# OpenOCD STM32F4 配置模板
# 文件: openocd_stm32f4.cfg
# 用途: STM32F4xx MCU 烧录与调试

# ============ 基础配置 ============
# 接口选择 (根据你的调试器选择)
# CMSIS-DAP
source [find interface/cmsis-dap.cfg]
# ST-Link
# source [find interface/stlink.cfg]
# J-Link
# source [find interface/jlink.cfg]

# 传输方式
transport select swd

# ============ 目标芯片配置 ============
# STM32F4xx 系列
set CHIPNAME stm32f4xx
set CPUID auto
source [find target/stm32f4x.cfg]

# ============ 适配器配置 ============
# 适配器时钟频率 (降低以提高稳定性)
adapter speed 4000

# ============ 复位配置 ============
# 复位策略
reset_config srst_only srst_nogate connect_assert_srst

# ============ 烧录配置 ============
# Flash 起始地址
set FLASH_BASE 0x08000000
set FLASH_SIZE 0x100000  # 1MB for STM32F407

# ============ 工作流程命令 ============
# program <elf>        - 烧录并验证
# program <elf> verify - 烧录、验证、重置
# program <elf> reset  - 烧录并复位
# flash write_image erase <elf> - 擦除后烧录
# reset run            - 复位并运行

# ============ 使用示例 ============
# openocd -f openocd_stm32f4.cfg -c "program build/v5_nca_mesh.elf verify reset exit"
# openocd -f openocd_stm32f4.cfg -c "program build/v5_nca_mesh.elf verify reset" -c shutdown
